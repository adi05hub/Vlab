CREATE TABLE EMPLOYEE(
EID INT PRIMARY KEY,
NAME VARCHAR2(20),
ADDRESS VARCHAR2(20),
GENDER CHAR(1) CHECK(GENDER ='M' OR GENDER ='F'),
SALARY NUMBER(6),
SUPEREID REFERENCES EMPLOYEE(EID),
DNO NUMBER);

CREATE TABLE DEPARTMENT (
DNUM NUMBER(5) PRIMARY KEY,
DNAME VARCHAR2(10) ,
DMGR_ID REFERENCES EMPLOYEE(EID),
MGR_START_DATE DATE);

CREATE TABLE DLOCATION (
DNO REFERENCES DEPARTMENT(DNUM),
DLOCATION VARCHAR2(10),
PRIMARY KEY(DNO,LOCATION));

CREATE TABLE PROJECT(
PNUM NUMBER(2) PRIMARY KEY,
PNAME VARCHAR2(20),
PLOCATION VARCHAR2(20),
DNO NUMBER REFERENCES DEPARTMENT(DNUM) );

CREATE TABLE WORKS_ON (
EID NUMBER(5) REFERENCES EMPLOYEE(EID),
PNO NUMBER(2) REFERENCES PROJECT(PNUM),
HOURS NUMBER(5,2),
PRIMARY KEY(EID,PNO));

CREATE TABLE DEPENDENT(
EMPID INT CONSTRAINT DEP_EMPID_PK PRIMARY KEY,
DEP_NAME VARCHAR2(12),
GENDER VARCHAR2(5),
BDATE DATE,
RELATIONSHIP VARCHAR2(12),
FOREIGN KEY(EMPID)REFERENCES EMPLOYEE(EID) ON DELETE CASCADE);

ALTER TABLE EMPLOYEE ADD CONSTRAINT FK FOREIGN KEY(DNO) REFERENCES
DEPARTMENT(DNUM);


INSERT INTO EMPLOYEE VALUES
('&EID','&NAME','&ADDRESS','&GENDER','&SALARY','&SUPEREID','&DNO')

INSERT INTO EMPLOYEE VALUES(1, 'RAHUL' , 'MANGALURU',
'M',35000,1,NULL);



INSERT INTO DEPARTMENT VALUES
('&DNUM','&DNAME','&DMGR_ID','&MGR_START_DATE')

INSERT INTO DEPARTMENT VALUES(1,'CSE',1,'2-NOV-2007');


ALTER TABLE EMPLOYEE ADD CONSTRAINT FK FOREIGN KEY(DNO) REFERENCES
DEPARTMENT(DNUM);


SQL> UPDATE EMPLOYEE SET DNO=4 WHERE EID=1;
SQL>UPDATE EMPLOYEE SET DNO=1WHERE EID=2;
SQL>UPDATE EMPLOYEE SET DNO=3 WHERE EID=3;
SQL>UPDATE EMPLOYEE SET DNO=3 WHERE EID=4;
SQL>UPDATE EMPLOYEE SET DNO=3 WHERE EID=5;


INSERT INTO DLOCATION VALUES ('&DNO','&DLOCATION')

INSERT INTO DLOCATION VALUES (1,'MANGALURU')


INSERT INTO PROJECT VALUES ('&PNUM','&PNAME','&PLOACTION','&DNO')

INSERT INTO PROJECT VALUES (2,'DATA MINING','MANAGLURU',1);




INSERT INTO WORKS_ON VALUES ('&EID','&PNO','&HOURS')

INSERT INTO WORKS_ON VALUES (1,1,4);


INSERT INTO DEPENDENTVALUES ('& EMPID','& DEP_NAME','& GENDER', '&
BDATE', '& RELATIONSHIP')

INSERT INTO DEPENDENT VALUES(1,'SHREYA','F','22-JAN-1975','WIFE')




SELECT PNO
FROM WORKS_ON
WHERE EID IN
(SELECT EID FROM EMPLOYEE WHERE NAME='RAHUL')
UNION
SELECT PNUM
FROM PROJECT
WHERE DNO IN
(SELECT DNUM FROM DEPARTMENT WHERE DMGR_ID IN
(SELECT EID FROM EMPLOYEE WHERE NAME='RAHUL'));





SELECT EID,NAME, SALARY,SALARY+0.1*SALARY AS UPDATED_SALARY
FROM EMPLOYEE
WHERE EID IN
(SELECT EID FROM WORKS_ON WHERE PNO IN(
SELECT PNUM FROM PROJECT WHERE PNAME='IOT'));




SELECT SUM(SALARY), AVG(SALARY), MAX(SALARY), MIN(SALARY)
FROM EMPLOYEE E,DEPARTMENT D
WHERE D.DNUM=E.DNO AND DNAME='ACCOUNT';




SELECT EID,NAME
FROM EMPLOYEE E
WHERE NOT EXISTS(
(SELECT PNUM FROM PROJECT WHERE DNO=5) MINUS
(SELECT PNO FROM WORKS_ON W WHERE W.EID=E.EID) );



CREATE VIEW DEPT_INFO(NAME,COUNT_EMP,SUM_SAL) AS
SELECT D.DNAME, COUNT(*), SUM(SALARY)
FROM DEPARTMENT D INNER JOIN EMPLOYEE E
ON E.DNO = D.DNUM
GROUP BY D.DNAME;





